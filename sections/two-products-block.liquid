<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
 {{ 'component-rating.css' | asset_url | stylesheet_tag }}
<section class="two-product-section" id="two-product-section">
  <div class="two-product-section__header">
    {% if section.settings.title != blank %}
      <h2 class="two-product-section__heading">{{ section.settings.title }}</h2>
    {% endif %}
  </div>
  <div class="two-product-cards">
    {% for block in section.blocks %}
      {% assign product = all_products[block.settings.product] %}
      {% if product %}
        {% assign variant = product.variants.first %}
        {% assign price = variant.price %}
        {% assign compare_price = variant.compare_at_price %}
        {% if compare_price and compare_price > price %}
          {% assign has_discount = true %}
          {% assign discount = compare_price | minus: price | times: 100.0 | divided_by: compare_price | round %}
        {% else %}
          {% assign has_discount = false %}
        {% endif %}

        <div class="two-product-card">
          <div class="two-product-card__container">
            {% if block.settings.custom_image != blank %}
              <a href="{{ product.url }}" class="two-product-card__image"
                ><img src="{{ block.settings.custom_image | img_url: '400x' }}" alt=""
              ></a>
            {% endif %}

            <div class="two-product-card__content">
              <h3 class="two-product-card__title">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>
              {% comment %}
                <div class="two-product-card__ratings">
                  <div style="color: #FFC300;">{{ block.settings.rating }}</div>
                  <div class="two-product-card__ratings-text">{{ block.settings.reviews }}</div>
                </div>
              {% endcomment %}
              <div class="two-product-card__ratings">
                {%- if product.metafields.reviews.rating.value != blank -%}
                  {% liquid
                    assign rating_decimal = 0
                    assign decimal = product.metafields.reviews.rating.value.rating | modulo: 1
                    if decimal >= 0.3 and decimal <= 0.7
                      assign rating_decimal = 0.5
                    elsif decimal > 0.7
                      assign rating_decimal = 1
                    endif
                  %}

                  <div
                    class="rating"
                    role="img"
                    aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: product.metafields.reviews.rating.value, rating_max: product.metafields.reviews.rating.value.scale_max }}"
                  >
                    <span
                      aria-hidden="true"
                      class="rating-star"
                      style="--rating: {{ product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                    ></span>
                  </div>

                  <p class="two-product-card__ratings-text">
                    {{ product.metafields.reviews.rating_count }} {{ 'accessibility.total_reviews' | t }}
                  </p>
                {%- endif -%}
              </div>
              <hr class="two-product-card__divider">
              <ul class="two-product-card__features-list">
                {% assign features = block.settings.features | split: ';' %}
                {% for item in features %}
                  <li>
                    {{ 'checkbox-promo.svg' | inline_asset_content }}
                    {{ item | strip }}
                  </li>
                {% endfor %}
              </ul>
              <div class="actions__container">
              <p class="two-product-card__caption">{{ block.settings.caption }}</p>
              {% comment %} <div class="two-product-card__price-row">
                {% if has_discount %}
                  <div class="two-product-card__discount-badge">
                    {{ block.settings.discount }}
                    {{ discount }}%
                  </div>
                  <p class="two-product-card__prices">
                    <s>{{ compare_price | money }}</s>
                    <strong>{{ price | money }}</strong>
                  </p>
                {% else %}
                  <p class="two-product-card__prices">
                    <strong>{{ price | money }}</strong>
                  </p>
                {% endif %}
              </div> {% endcomment %}
              <div class="two-product-card__price-row">
                {% if has_discount %}
                  <div class="two-product-card__discount-badge">
                    {{ block.settings.discount }}
                    {{ discount }}%
                  </div>
                {% else %}
                  <div class="two-product-card__discount-placeholder" aria-hidden="true"></div>
                {% endif %}

                <p class="two-product-card__prices">
                  {% if has_discount %}<s>{{ compare_price | money }}</s>{% endif %}
                  <strong>{{ price | money }}</strong>
                </p>
              </div>
              
              <product-form data-section-id="{{ section.id }}" class="custom-product-form">
                {% form 'product', product, class: 'product-form', data-type: 'add-to-cart-form' %}
                  <input
                    type="hidden"
                    name="id"
                    value="{{ variant.id }}"
                    class="product-variant-id"
                    {% unless variant.available %}
                      disabled
                    {% endunless %}
                  >

                  <button
                    type="submit"
                    name="add"
                    class="two-product-card__actions-button"
                    aria-live="polite"
                    {% unless variant.available %}
                      disabled
                    {% endunless %}
                  >
                    {{ 'lauron-cart.svg' | inline_asset_content }}
                    <span>
                      {% if variant.available %}
                        {{ block.settings.buy_button }}
                      {% else %}
                        {{ 'products.product.sold_out' | t }}
                      {% endif %}
                    </span>
                    <span class="sold-out-message hidden">
                      {{ 'products.product.sold_out' | t }}
                    </span>
                    {% render 'loading-spinner' %}
                  </button>
                {% endform %}
              </product-form>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.two-product-card__ratings-text').forEach((el) => {
      el.style.cursor = 'pointer';
      el.addEventListener('click', () => {
        const target = document.querySelector('#testimonials');
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  });
</script>

<style>
    .two-product-section {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      margin-bottom: 120px;
    }
    .two-product-section__header {
      display: flex;
      flex-direction: column;
      gap: 30px;
      padding-right: 10px;
      padding-left: 50px;
      margin-bottom: 60px;
      margin-top: 120px;
    }
    .two-product-section__heading {
      font-family: var(--font-heading-main);
      font-size: 42px;
      font-weight: 700;
      margin: 0;
      line-height: 30px;
    }
    .two-product-card__container {
      display: flex;
      gap: 58px;
      align-items: center;
    }
    .two-product-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 40px;
    }
    .two-product-card {
      background: #F0F4F5;
      padding: 40px 30px 35px 40px;
      border-radius: 20px;
      flex: 1 1 45%;
    }
    .two-product-card__title {
      font-family: var(--font-heading-main);
      font-weight: 700;
      font-size: 24px;
      line-height: 24px;
      margin: 0;
    }
    .two-product-card__title a {
      color: inherit;
      text-decoration: none;
    }
    .two-product-card__ratings {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .two-product-card__ratings .rating-star:before {
      font-size: 20px;
    }
    .two-product-card__ratings-text {
      font-size: 12px;
      line-height: 12px;
      font-weight: 500;
      font-family: Inter, sans-serif;
      color: var(--color-subtext);
      text-decoration: underline;
    }
    .two-product-card__divider {
      margin-top: 16px;
      margin-bottom: 20px;
      background: #D7D7D7;
    }
    .two-product-card img {
      max-width: 160px;
      height: auto;
    }
    .two-product-card__features-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      list-style: none;
      padding: 0;
      margin-bottom: 30px;
      margin-top: 0;
    }
    .two-product-card__features-list li {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      line-height: 12px;
      color: var(--color-main-text);
    }
    .two-product-card__caption {
      font-family: Inter, sans-serif;
      font-size: 12px;
      line-height: 12px;
      color: var(--color-subtext);
    }
    .two-product-card__discount-badge {
      font-family: var(--font-heading-main);
      font-weight: 700;
      font-size: 16px;
      line-height: 12px;
      color: #FF2400;
      min-height: 12px;
      display: inline-flex;
      align-items: center;
    }
    .two-product-card__discount-placeholder {
      min-height: 12px;    
      display: inline-block;
    }
    .two-product-card__price-row  {
      display: flex;
      flex-direction: column;
      gap: 20px;
      justify-content: space-between;
      align-self: center;
      {% comment %} align-items: center;
      margin-bottom: 32px; {% endcomment %}
    }
    .two-product-card__prices {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-family: var(--font-heading-main);
      font-weight: 500;
      font-size: 22px;
      line-height: 12px;
      color: var(--color-main-text);
      margin: 0;
    }
    .two-product-card__prices s {
      font-size: 12px;
    }
    .two-product-card__content {
      width: 100%;
      display: flex;
      flex-direction: column;
    }
    .two-product-card__caption {
      margin-bottom: 20px;
    }
    .two-product-card__actions-button {
      font-size: 14px;
      line-height: 12px;
      color: #fff;
      font-weight: 700;
      background-color: var(--color-main-text);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 13px 28px;
      cursor: pointer;
      text-transform: uppercase;
    }
    .custom-product-form {
      align-self: flex-end;
    }

    .two-product-card__actions-button:hover {
      background-color: #333;
    }

    .actions__container {
      display: flex;
      justify-content: space-between;
    }

      @media (max-width: 749px) {
        .two-product-section__header {
          padding: 0 10px;
          margin-bottom: 50px;
        }
        .two-product-section__heading {
          font-size: 24px;
          line-height: 24px;
        }
        .two-product-cards {
          flex-direction: column;
          gap: 30px;
        }
        .two-product-card {
          padding: 16px;
        }
        .two-product-card__container {
          flex-direction: column;
          align-items: center;
          gap: 30px;
        }
        .two-product-card__title {
          font-size: 18px;
          line-height: 20px;
        }
        .two-product-card__features-list li {
          font-size: 12px;
          line-height: 12px;
        }
        .two-product-card__divider {
          margin-top: 14px;
          margin-bottom: 16px;
        }
        .two-product-card__caption {
          font-size: 10px;
          line-height: 12px;
          margin-bottom: 15px;
        }
        .two-product-card__discount-badge,
        .two-product-card__prices {
          font-size: 14px;
          line-height: 12px;
        }
        .two-product-card__features-list {
          margin-bottom: 24px;
        }
        .two-product-card__actions-button {
          font-size: 10px;
          line-height: 12px;
          padding: 12px 24px;
        }
      }
      @media (max-width: 1279px) {
        .two-product-section {
          padding: 0 10px;
        }
      }

  @media (min-width: 750px) and (max-width: 1240px) {
    .two-product-cards {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 24px;
      align-items: stretch;
    }

    .two-product-card {
      height: 100%;
      padding: 20px;
    }

    .two-product-card__container {
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 16px;
      padding: 16px;
      border-radius: 16px;
    }

    .two-product-card__container > a img {
      width: 100%;
      height: 260px;
      object-fit: cover;
      border-radius: 12px;
      display: block;
    }

    .two-product-card__title {
      margin: 0 0 8px;
    }
    .two-product-card__title a {
      font-size: 22px;
      line-height: 1.25;
      word-break: break-word;
      hyphens: auto;
      display: inline-block;
      text-decoration: none;
    }

    .two-product-card__ratings {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    .two-product-card__ratings-text {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .two-product-card__image {
      justify-self: center;
    }

    .two-product-card__divider {
      margin: 12px 0;
    }

    .two-product-card__features-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin: 0 0 10px;
      padding: 0;
      list-style: none;
    }

    .two-product-card__caption {
      margin: 6px 0 0;
      font-size: 14px;
      line-height: 1.4;
      color: var(--color-subtext);
    }

    .two-product-card__price-row {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      margin-top: 12px;
    }

    .two-product-card__discount-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      white-space: nowrap;
    }

    .two-product-card__actions-button {
      width: 100%;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 14px;
      min-height: 44px;
      border-radius: 20px;
      padding: 10px 14px;
    }

    .two-product-section__heading {
      font-size: 32px;
      line-height: 1.25;
      margin: 0 0 16px;
      word-break: break-word;
      hyphens: auto;
    }

    .two-product-section__header {
      padding: 0 16px;
    }
  }
</style>

{% schema %}
{
  "name": "Two Product Promo",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Заголовок",
      "default": "Купуйте зараз"
    }
  ],
  "blocks": [
    {
      "type": "product_block",
      "name": "Product Block",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Виберіть товар"
        },
        {
          "type": "image_picker",
          "id": "custom_image",
          "label": "Своя картинка товару"
        },
        {
          "type": "text",
          "id": "rating",
          "label": "Рейтинг",
          "default": "★ ★ ★ ★ ★"
        },
        {
          "type": "text",
          "id": "reviews",
          "label": "К-сть відгуків",
          "default": "31 відгук"
        },
        {
          "type": "text",
          "id": "discount",
          "label": "Знижка",
          "default": "Збережіть"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Підписка",
          "default": "For a two-week subscription:"
        },
        {
          "type": "text",
          "id": "features",
          "label": "Список переваг (через крапку з комою)",
          "default": "Change or cancel anytime; Change or cancel anytime; Change or cancel anytime"
        },
        {
          "type": "text",
          "id": "buy_button",
          "label": "Текст кнопки 'Купити'",
          "default": "Купити"
        }
      ]
    }
  ],
  "max_blocks": 2,
  "presets": [
    {
      "name": "Two Product Promo",
      "blocks": [
        {
          "type": "product_block"
        },
        {
          "type": "product_block"
        }
      ]
    }
  ]
}
{% endschema %}
