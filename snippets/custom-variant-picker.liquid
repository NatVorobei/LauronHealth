{% assign option_index = 0 %}
{% assign option = product.options_with_values[option_index] %}

<variant-selects
  id="variant-selects-{{ section.id }}"
  data-section="{{ section.id }}"
  data-url="{{ product.url }}"
  {{ block.shopify_attributes }}
>
  <div class="custom-variant-picker">
    <label class="form__label">{{ option.name }}</label>
    <div class="custom-variant-options">
      {% for value in option.values %}
        {% assign variant = product.variants | where: 'option1', value | first %}
        {% assign image = variant.featured_image | default: product.featured_image %}
        <button
          type="button"
          class="variant-thumb {% if forloop.first %}active{% endif %}"
          data-value="{{ value }}"
          aria-label="{{ value }}"
        >
          <img src="{{ image | image_url: width: 120 }}" alt="{{ value }}">
          <span>{{ value }}</span>
        </button>
      {% endfor %}
    </div>

    <select class="visually-hidden" name="options[{{ option.name | escape }}]">
      {% for value in option.values %}
        <option value="{{ value }}" {% if forloop.first %}selected{% endif %}>
          {{ value }}
        </option>
      {% endfor %}
    </select>
  </div>

  <script type="application/json" data-product>
    {{ product | json }}
  </script>
  <script type="application/json" data-selected-variant>
    {{ product.selected_or_first_available_variant | json }}
  </script>
</variant-selects>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const container = document.querySelector("#variant-selects-{{ section.id }}");
    if (!container) return;

    const buttons = container.querySelectorAll(".variant-thumb");
    const select = container.querySelector("select");

    buttons.forEach(button => {
      button.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        button.classList.add("active");

        const value = button.dataset.value;

        // Set selected option
        for (let opt of select.options) {
          opt.selected = opt.value === value;
        }

        // Dispatch change so Shopify's variant-selects reacts
        select.dispatchEvent(new Event("change", { bubbles: true }));
      });
    });
  });
</script>



<style>
.custom-variant-image-picker {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.variant-image-button {
  border: 2px solid transparent;
  padding: 0.5rem;
  border-radius: 12px;
  background: none;
  cursor: pointer;
  text-align: center;
  transition: border 0.2s;
}

.variant-image-button img {
  width: 100px;
  height: auto;
  border-radius: 8px;
}

.variant-image-button.active {
  border-color: black;
}

.variant-label {
  margin-top: 0.5rem;
  font-weight: bold;
  font-size: 14px;
}


</style>