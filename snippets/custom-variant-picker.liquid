{%- assign option = product.options_with_values[0] -%}
<div class="custom-variant-picker-wrapper">
  <label class="form__label">{{ option.name }}</label>
  <div class="custom-variant-image-picker">
    {% for value in option.values %}
      {% assign variant = product.variants | where: "option1", value | first %}
      {% assign image = variant.featured_image | default: product.featured_image %}
      <button
        type="button"
        class="variant-image-button {% if forloop.first %}active{% endif %}"
        data-value="{{ value }}"
      >
        <img src="{{ image | image_url: width: 150 }}" alt="{{ value }}">
        <div class="variant-label">{{ value }}</div>
      </button>
    {% endfor %}
  </div>

  <select
    class="visually-hidden"
    name="options[{{ option.name | escape }}]"
    form="{{ product_form_id }}"
  >
    {% for value in option.values %}
      <option value="{{ value }}" {% if forloop.first %}selected{% endif %}>{{ value }}</option>
    {% endfor %}
  </select>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const wrapper = document.querySelector('.custom-variant-picker-wrapper');
    if (!wrapper) return;

    const buttons = wrapper.querySelectorAll('.variant-image-button');
    const select = wrapper.querySelector('select');

    buttons.forEach(button => {
      button.addEventListener('click', () => {
        buttons.forEach(b => b.classList.remove('active'));
        button.classList.add('active');
        const value = button.dataset.value;

        Array.from(select.options).forEach(opt => {
          opt.selected = opt.value === value;
        });

        // Trigger change event to notify Shopify + Appstle
        select.dispatchEvent(new Event('change', { bubbles: true }));
      });
    });
  });
</script>


<style>
  .custom-variant-options {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.custom-variant-option {
  cursor: pointer;
  display: inline-block;
}

.custom-variant-option input {
  display: none;
}

.custom-variant-box {
  border: 2px solid transparent;
  padding: 0.5rem;
  border-radius: 12px;
  text-align: center;
  transition: border 0.3s;
}

.custom-variant-box img {
  max-width: 100px;
  border-radius: 8px;
}

.custom-variant-option input:checked + .custom-variant-box {
  border: 2px solid black;
}

.custom-variant-label {
  margin-top: 0.5rem;
  font-weight: bold;
  font-size: 14px;
}

</style>