{%- assign free_shipping_goal = settings.free_shipping_goal | times: 100 -%}
{%- assign cart_total = cart.total_price -%}
{%- assign remaining_amount = free_shipping_goal | minus: cart_total | at_least: 0 -%}
{%- assign cart_total_percent = cart_total | times: 100 -%}
{%- assign progress_percentage_raw = cart_total_percent | divided_by: free_shipping_goal -%}
{%- assign progress_percentage = progress_percentage_raw | round | at_most: 100 | at_least: 0 -%}

<div class="cart-drawer__free-shipping">
  {% if cart_total >= free_shipping_goal %}
    <p class="cart-drawer__free-shipping-text">
      {{ settings.free_shipping_text_success }}
      {{ 'exspress-delivery.svg' | inline_asset_content }}
    </p>
  {% else %}
    <p class="cart-drawer__free-shipping-text">
      {{ settings.free_shipping_text_before }}
      {{ remaining_amount | money_without_trailing_zeros }}
      {{ settings.free_shipping_text_after }}
      {{ 'exspress-delivery.svg' | inline_asset_content }}
    </p>
  {% endif %}

  <div class="cart-drawer__free-shipping-bar">
    <div
      class="cart-drawer__free-shipping-progress"
      style="width: {{ progress_percentage }}%;"
      data-debug="{{ progress_percentage }}"
    ></div>
  </div>
</div>

<style>
  .cart-drawer__free-shipping-bar {
    position: relative;
    width: 100%;
    height: 4px;
    background-color: #e5e5e5;
    border-radius: 2px;
    overflow: visible;
    margin-bottom: 30px;
  }

  .cart-drawer__free-shipping-progress {
    position: relative;
    height: 100%;
    background-color: red;
    border-radius: 2px;
    transition: width 0.4s ease;
  }

  .cart-drawer__free-shipping-progress::after {
    content: '';
    position: absolute;
    top: 50%;
    right: 0;
    transform: translate(50%, -50%);
    width: 12px;
    height: 12px;
    background-color: red;
    border-radius: 50%;
    box-shadow: 0 0 0 1px white;
  }

  .cart-drawer__free-shipping-text {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    padding: 30px 0 20px 0;
  }
</style>
